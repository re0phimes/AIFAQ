# faq-generator

从技术文档中提取核心知识点并生成高质量 QA 对。

## 输入

- 文档 Markdown 文本
- 已有标签列表（用于复用标签，保持一致性）

## 输出

QA 对列表，每个包含：
- `question`: 中文问题
- `answer`: 中文答案（Markdown 格式，支持 LaTeX 公式用 `$` 或 `$$` 包裹）
- `tags`: 2-5 个中文技术标签
- `categories`: 1-2 个分类
- `confidence`: 0-1 的置信度

## 生成规则

1. 根据文档长度自适应生成数量（约每 1000 字 1-2 个 QA）
2. 问题要像真实用户会问的，自然、有场景感，不要生硬拼凑
3. 答案要完整、准确，读者不需要看原文也能理解
4. 尽量复用已有标签，保持标签体系一致
5. 公式必须包含：来源说明、参数定义、代入实际值的示例

### LaTeX 公式格式准确性（硬性要求）

生成或改写时，所有 LaTeX 公式必须格式正确且可渲染：

- 行内公式用 `$...$` 包裹，行间公式用 `$$...$$` 包裹
- 确保 `$` 配对闭合，不出现孤立的 `$`
- JSON 中的 LaTeX 需要正确转义：`\\` 在 JSON 字符串中写为 `\\\\`（如 `$\\\\text{FLOPs}$`）
- 检查常见错误：`\times` 写成 `\\times`（JSON 中应为 `\\\\times`）、下标 `_` 未用 `{}` 包裹多字符
- **生成/改写完成后，必须逐条检查所有公式能否正确渲染，发现问题立即修复**

## 示例调用

```
根据以下文档生成 FAQ：
[粘贴文档内容]
```

## Rewrite Mode (改写模式)

当用户提供一个已有 QA 的 JSON 文件路径和 judge 的改进建议时，进入改写模式。

### 输入

- 已有 QA 的 JSON 文件路径（如 `data/faq-sync/42.json`）
- faq-judge 的改进建议（来自 `_report.json` 中对应条目的 `question_suggestion` 和 `answer_suggestion`）

### 处理流程

1. 读取指定 JSON 文件，获取当前 `question` 和 `answer`
2. 读取 `_report.json` 中该条目的评分和改进建议
3. 根据建议改进内容，重点修复低分维度
4. 将改进后的内容写回同一 JSON 文件

### 改写规则

- 保留原始 question，除非 `scenario_completeness` 分数过低（< 3），此时需要补充场景约束（如模型名称、参数规模、硬件环境等）
- 所有公式必须包含：
  - 来源说明（公式出处或推导依据）
  - 参数定义（每个符号的含义和单位）
  - 场景代入（用问题中的实际值代入计算）
- 答案必须自包含（independence），读者不需要参考其他文档即可理解
- 改进后在 JSON 中设置 `_change_reason` 字段，描述本次改写的内容和原因

### 输出格式

改写后的 JSON 文件保持原有结构，更新以下字段：
- `answer`: 改进后的答案
- `answer_brief`: 如有需要同步更新
- `question`: 仅在 scenario_completeness 不达标时修改
- `_change_reason`: 描述改写内容（如 "补充 LoRA 显存公式的参数定义和代入计算；增强答案独立性"）

### 示例调用

```
改写 data/faq-sync/42.json，参考 _report.json 中的建议
```
